<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SEO & Metadata -->
    <title>DuoWatch | Dual Stopwatch</title>
    <meta name="description" content="A simple, mobile-first dual stopwatch.">
    <link rel="canonical" href="https://duowatch.vercel.app">
    
    <!-- Icons & Social -->
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link rel="apple-touch-icon" href="logo.svg">
    <meta name="theme-color" content="#000000">
    <meta property="og:title" content="DuoWatch | Dual Stopwatch">
    <meta property="og:description" content="A simple, mobile-first dual stopwatch.">
    <meta property="og:image" content="logo.svg">
    <meta property="og:url" content="https://duowatch.vercel.app">
    <meta property="og:type" content="website">

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'JetBrains Mono', monospace;
            overscroll-behavior: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 2px; }
        
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        * { -webkit-tap-highlight-color: transparent; }

        /* --- Menu Animation Styles --- */
        
        /* Default Open State */
        #btn-theme, #btn-lap-toggle, #btn-mail {
            transform: translate(0, 0) scale(1);
            opacity: 1;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Collapsed State (Items move INTO the logo) */
        
        /* Portrait (Horizontal Movement) */
        #control-bar.collapsed #btn-theme {
            transform: translateX(450%) scale(0.1);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #control-bar.collapsed #btn-lap-toggle {
            transform: translateX(250%) scale(0.1);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #control-bar.collapsed #btn-mail {
            transform: translateX(-320%) scale(0.1);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Landscape (Vertical Movement) */
        @media (orientation: landscape) {
            #control-bar.collapsed #btn-theme {
                transform: translateY(500%) scale(0.1);
            }
            #control-bar.collapsed #btn-lap-toggle {
                transform: translateY(280%) scale(0.1);
            }
            #control-bar.collapsed #btn-mail {
                transform: translateY(-350%) scale(0.1);
            }
        }
    </style>
</head>
<body class="bg-black h-screen w-screen overflow-hidden text-white no-select flex flex-col landscape:flex-row">

    <!-- STOPWATCH 1 (Left/Top) -->
    <div class="flex-1 relative flex flex-col justify-between p-4 transition-colors duration-300 cursor-pointer active:brightness-110 border-b-2 landscape:border-b-0 landscape:border-r-2 border-black/30" id="bg-1" onclick="sw1.handleBoxClick(event)">
        <!-- Header -->
        <div class="flex justify-between items-center opacity-70 pointer-events-none">
            <span class="font-bold uppercase tracking-widest text-sm" id="label-1"><i class="fas fa-stopwatch mr-2"></i>Timer A</span>
            <button onclick="sw1.toggleMute()" class="text-white/50 hover:text-white transition pointer-events-auto p-2">
                <i class="fas fa-volume-up" id="icon-mute-1"></i>
            </button>
        </div>

        <!-- Time Display -->
        <div class="flex-grow flex flex-col justify-center items-center my-2 pointer-events-none">
            <div id="display-1" class="text-6xl sm:text-7xl md:text-8xl font-bold tracking-tighter tabular-nums drop-shadow-lg transition-colors duration-300">
                00:00<span class="text-4xl sm:text-5xl md:text-6xl align-top opacity-70">.00</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-2 gap-4 mb-2">
            <!-- Lap button hidden by default -->
            <button id="btn-lap-1" onclick="sw1.lap()" disabled class="hidden py-3 sm:py-4 rounded-2xl bg-black/20 text-white/50 font-bold text-lg backdrop-blur-sm transition-all disabled:opacity-30 disabled:cursor-not-allowed border border-white/10 pointer-events-auto z-10 hover:bg-black/40">
                LAP
            </button>
            <!-- Start button spans full width by default -->
            <button id="btn-start-1" onclick="sw1.toggle()" class="col-span-2 py-3 sm:py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all pointer-events-auto z-10 text-white">
                START
            </button>
        </div>
        
        <!-- Laps (Hidden by default) -->
        <div id="laps-wrapper-1" class="hidden h-20 landscape:h-24 rounded-xl p-2 overflow-y-auto pointer-events-auto z-10 backdrop-blur-sm transition-colors duration-300" onclick="event.stopPropagation()">
            <table class="w-full text-sm transition-colors duration-300">
                <tbody id="laps-1" class="font-mono"></tbody>
            </table>
            <div id="empty-laps-1" class="h-full flex items-center justify-center text-xs italic transition-colors duration-300">No laps</div>
        </div>
    </div>

    <!-- FLOATING CONTROL ICONS -->
    <!-- Updated landscape:top-[40%] to better center logo with time -->
    <div id="control-bar" class="absolute top-1/2 landscape:top-[40%] left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 
                flex items-center justify-center pointer-events-none
                flex-row space-x-3
                landscape:flex-col landscape:space-x-0 landscape:space-y-4">
        
        <!-- 1. Color Picker -->
        <button id="btn-theme" onclick="cycleTheme()" class="w-10 h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-md text-white/70 hover:text-white hover:bg-black/70 transition-all pointer-events-auto relative z-0 shadow-lg border border-white/10" title="Change Theme">
            <i class="fas fa-palette"></i>
        </button>

        <!-- 2. Lap Mode Toggle (New) -->
        <button id="btn-lap-toggle" onclick="toggleLapMode()" class="w-10 h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-md text-white/70 hover:text-white hover:bg-black/70 transition-all pointer-events-auto relative z-0 shadow-lg border border-white/10" title="Toggle Lap Mode">
            <i class="fas fa-flag"></i>
        </button>

        <!-- 3. Reset -->
        <button onclick="resetAll()" class="w-10 h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-md text-white/70 hover:text-white transition-all hover:bg-black/70 pointer-events-auto relative z-10 shadow-lg border border-white/10" title="Reset All">
            <i class="fas fa-undo text-sm"></i>
        </button>

        <!-- 4. Logo (Trigger) -->
        <div onclick="toggleMenu()" class="w-12 h-12 md:w-14 md:h-14 hover:scale-110 active:scale-95 transition-transform duration-300 cursor-pointer relative z-20 pointer-events-auto drop-shadow-2xl" title="Toggle Menu">
            <img src="logo.svg" alt="DuoWatch Logo" class="w-full h-full object-contain">
        </div>

        <!-- 5. Fullscreen -->
        <button onclick="toggleFullscreen()" id="btn-fullscreen" class="w-10 h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-md text-white/70 hover:text-white transition-all hover:bg-black/70 pointer-events-auto relative z-10 shadow-lg border border-white/10" title="Toggle Fullscreen">
            <i class="fas fa-expand"></i>
        </button>

        <!-- 6. Mail -->
        <a id="btn-mail" href="mailto:arunthomas04042001@gmail.com" class="w-10 h-10 flex items-center justify-center rounded-full bg-black/50 backdrop-blur-md text-white/70 hover:text-white hover:bg-black/70 pointer-events-auto relative z-0 shadow-lg border border-white/10" title="Contact Developer">
            <i class="fas fa-envelope"></i>
        </a>
    </div>

    <!-- STOPWATCH 2 (Right/Bottom) -->
    <div class="flex-1 relative flex flex-col justify-between p-4 transition-colors duration-300 cursor-pointer active:brightness-110" id="bg-2" onclick="sw2.handleBoxClick(event)">
        <!-- Header -->
        <div class="flex justify-between items-center opacity-70 pointer-events-none">
            <span class="font-bold uppercase tracking-widest text-sm" id="label-2"><i class="fas fa-stopwatch mr-2"></i>Timer B</span>
            <button onclick="sw2.toggleMute()" class="text-white/50 hover:text-white transition pointer-events-auto p-2">
                <i class="fas fa-volume-up" id="icon-mute-2"></i>
            </button>
        </div>

        <!-- Time Display -->
        <div class="flex-grow flex flex-col justify-center items-center my-2 pointer-events-none">
            <div id="display-2" class="text-6xl sm:text-7xl md:text-8xl font-bold tracking-tighter tabular-nums drop-shadow-lg transition-colors duration-300">
                00:00<span class="text-4xl sm:text-5xl md:text-6xl align-top opacity-70">.00</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-2 gap-4 mb-2">
            <!-- Lap button hidden by default -->
            <button id="btn-lap-2" onclick="sw2.lap()" disabled class="hidden py-3 sm:py-4 rounded-2xl bg-black/20 text-white/50 font-bold text-lg backdrop-blur-sm transition-all disabled:opacity-30 disabled:cursor-not-allowed border border-white/10 pointer-events-auto z-10 hover:bg-black/40">
                LAP
            </button>
            <!-- Start button spans full width by default -->
            <button id="btn-start-2" onclick="sw2.toggle()" class="col-span-2 py-3 sm:py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all pointer-events-auto z-10 text-white">
                START
            </button>
        </div>

        <!-- Laps (Hidden by default) -->
        <div id="laps-wrapper-2" class="hidden h-20 landscape:h-24 rounded-xl p-2 overflow-y-auto pointer-events-auto z-10 backdrop-blur-sm transition-colors duration-300" onclick="event.stopPropagation()">
            <table class="w-full text-sm transition-colors duration-300">
                <tbody id="laps-2" class="font-mono"></tbody>
            </table>
            <div id="empty-laps-2" class="h-full flex items-center justify-center text-xs italic transition-colors duration-300">No laps</div>
        </div>
    </div>

    <script>
        // Expanded Theme Configurations
        const themes = [
            { // 1. Default: Blue vs Red
                id: 0,
                t1: { text: 'text-blue-500', sub: 'text-blue-300', bgOff: 'bg-slate-900', bgOn: 'bg-slate-800', btn: 'bg-blue-600', shadow: 'shadow-blue-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-red-500', sub: 'text-red-300', bgOff: 'bg-zinc-900', bgOn: 'bg-zinc-800', btn: 'bg-red-600', shadow: 'shadow-red-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' }
            },
            { // 2. Neon: Green vs Purple
                id: 1,
                t1: { text: 'text-emerald-500', sub: 'text-emerald-300', bgOff: 'bg-neutral-900', bgOn: 'bg-neutral-800', btn: 'bg-emerald-600', shadow: 'shadow-emerald-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-purple-500', sub: 'text-purple-300', bgOff: 'bg-stone-900', bgOn: 'bg-stone-800', btn: 'bg-purple-600', shadow: 'shadow-purple-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' }
            },
            { // 3. Solar: Orange vs Cyan
                id: 2,
                t1: { text: 'text-orange-500', sub: 'text-orange-300', bgOff: 'bg-gray-900', bgOn: 'bg-gray-800', btn: 'bg-orange-600', shadow: 'shadow-orange-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-cyan-500', sub: 'text-cyan-300', bgOff: 'bg-slate-950', bgOn: 'bg-slate-900', btn: 'bg-cyan-600', shadow: 'shadow-cyan-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' }
            },
            { // 4. Chess (Panda): Black vs White
                id: 3,
                t1: { text: 'text-white', sub: 'text-gray-400', bgOff: 'bg-black', bgOn: 'bg-neutral-900', btn: 'bg-neutral-800', shadow: 'shadow-neutral-900/50', lapsBg: 'bg-white/10', lapsBorder: 'border-white/10', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-black', sub: 'text-gray-500', bgOff: 'bg-white', bgOn: 'bg-gray-100', btn: 'bg-black', shadow: 'shadow-xl', lapsBg: 'bg-black/5', lapsBorder: 'border-black/10', lapsText: 'text-black/60', lapsEmpty: 'text-black/30', lapsRow: 'hover:bg-black/5 border-black/5', lapsTextHigh: 'text-black' }
            },
            { // 5. Miami: Pink vs Teal
                id: 4,
                t1: { text: 'text-pink-500', sub: 'text-pink-300', bgOff: 'bg-pink-950/20', bgOn: 'bg-pink-900/40', btn: 'bg-pink-600', shadow: 'shadow-pink-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-teal-400', sub: 'text-teal-200', bgOff: 'bg-teal-950/20', bgOn: 'bg-teal-900/40', btn: 'bg-teal-600', shadow: 'shadow-teal-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' }
            },
            { // 6. Forest: Amber vs Emerald
                id: 5,
                t1: { text: 'text-amber-500', sub: 'text-amber-300', bgOff: 'bg-stone-950', bgOn: 'bg-stone-900', btn: 'bg-amber-600', shadow: 'shadow-amber-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' },
                t2: { text: 'text-lime-500', sub: 'text-lime-300', bgOff: 'bg-green-950', bgOn: 'bg-green-900', btn: 'bg-lime-600', shadow: 'shadow-lime-900/50', lapsBg: 'bg-black/20', lapsBorder: 'border-white/5', lapsText: 'text-white/60', lapsEmpty: 'text-white/30', lapsRow: 'hover:bg-white/5 border-white/5', lapsTextHigh: 'text-white' }
            }
        ];

        let currentThemeIndex = 0;
        let isLapMode = false;

        class Stopwatch {
            constructor(id) {
                this.id = id;
                this.startTime = 0;
                this.elapsedTime = 0;
                this.intervalId = null;
                this.isRunning = false;
                this.laps = [];
                this.isMuted = false;

                // DOM Elements
                this.displayEl = document.getElementById(`display-${id}`);
                this.lapBtn = document.getElementById(`btn-lap-${id}`);
                this.startBtn = document.getElementById(`btn-start-${id}`);
                this.lapsContainer = document.getElementById(`laps-${id}`);
                this.emptyMsg = document.getElementById(`empty-laps-${id}`);
                this.muteIcon = document.getElementById(`icon-mute-${id}`);
                this.bg = document.getElementById(`bg-${id}`);
                this.label = document.getElementById(`label-${id}`);
                this.lapsWrapper = document.getElementById(`laps-wrapper-${id}`);
                this.lapsTable = this.lapsContainer.parentElement;

                // Initialize with default theme
                this.applyTheme(themes[0]);
            }

            getThemeConfig() {
                const t = themes[currentThemeIndex];
                return this.id === 1 ? t.t1 : t.t2;
            }

            applyTheme(theme) {
                const config = this.id === 1 ? theme.t1 : theme.t2;
                
                // Reset BG classes
                const borderClass = this.id === 1 ? 'border-b-2 landscape:border-b-0 landscape:border-r-2 border-black/30' : '';
                this.bg.className = `flex-1 relative flex flex-col justify-between p-4 transition-colors duration-300 cursor-pointer active:brightness-110 ${borderClass} ${this.isRunning ? config.bgOn : config.bgOff}`;
                
                // Update Text Colors
                this.displayEl.className = `text-6xl sm:text-7xl md:text-8xl font-bold tracking-tighter tabular-nums drop-shadow-lg transition-colors duration-300 ${config.text}`;
                this.label.className = `font-bold uppercase tracking-widest text-sm ${config.sub}`;

                // Update Lap Container Visuals
                this.lapsWrapper.className = `h-20 landscape:h-24 rounded-xl p-2 overflow-y-auto pointer-events-auto z-10 backdrop-blur-sm transition-colors duration-300 ${config.lapsBg} ${config.lapsBorder} ${isLapMode ? 'block' : 'hidden'}`;
                this.lapsTable.className = `w-full text-sm transition-colors duration-300 ${config.lapsText}`;
                this.emptyMsg.className = `h-full flex items-center justify-center text-xs italic transition-colors duration-300 ${config.lapsEmpty}`;

                // Update Button if not running (if running, it's red)
                if (!this.isRunning) {
                    this.updateStartButtonVisuals(config.btn, config.shadow, 'text-white');
                }
                
                this.updateDisplay();
                this.renderLaps();
            }

            updateStartButtonVisuals(bgClass, shadowClass, textClass) {
                // Ensure correct span class is maintained based on lap mode
                const spanClass = isLapMode ? '' : 'col-span-2';
                this.startBtn.className = `${spanClass} py-3 sm:py-4 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition-all pointer-events-auto z-10 ${bgClass} ${shadowClass} ${textClass}`;
            }

            handleBoxClick(e) {
                if (e.target.closest('button') || e.target.closest('a') || e.target.closest('input')) return;
                this.toggle();
            }

            formatTime(ms) {
                const date = new Date(ms);
                const m = date.getUTCMinutes().toString().padStart(2, '0');
                const s = date.getUTCSeconds().toString().padStart(2, '0');
                const cs = Math.floor(date.getUTCMilliseconds() / 10).toString().padStart(2, '0');
                
                const config = this.getThemeConfig();
                return `${m}:${s}<span class="text-4xl sm:text-5xl md:text-6xl align-top ${config.sub}">.${cs}</span>`;
            }

            formatTimePlain(ms) {
                const date = new Date(ms);
                const m = date.getUTCMinutes().toString().padStart(2, '0');
                const s = date.getUTCSeconds().toString().padStart(2, '0');
                const cs = Math.floor(date.getUTCMilliseconds() / 10).toString().padStart(2, '0');
                return `${m}:${s}.${cs}`;
            }

            toggle() {
                this.isRunning ? this.stop() : this.start();
            }

            start() {
                if (this.isRunning) return;
                
                const config = this.getThemeConfig();
                this.startTime = Date.now() - this.elapsedTime;
                this.intervalId = setInterval(() => {
                    this.elapsedTime = Date.now() - this.startTime;
                    this.updateDisplay();
                }, 10);
                
                this.isRunning = true;
                
                // Update Visuals for Running State
                this.startBtn.textContent = "STOP";
                this.updateStartButtonVisuals('bg-red-500', 'shadow-red-900/50', 'text-white');
                
                if (isLapMode) {
                    this.lapBtn.textContent = "LAP";
                    this.lapBtn.disabled = false;
                }
                
                this.bg.classList.remove(config.bgOff);
                this.bg.classList.add(config.bgOn);
                
                this.playSound('start');
            }

            stop() {
                if (!this.isRunning) return;
                
                clearInterval(this.intervalId);
                this.isRunning = false;
                
                const config = this.getThemeConfig();
                
                // Update Visuals for Stopped State
                this.startBtn.textContent = "RESUME";
                this.updateStartButtonVisuals('bg-green-600', 'shadow-green-900/50', 'text-white');
                
                if (isLapMode) {
                    this.lapBtn.textContent = "RESET";
                    this.lapBtn.disabled = false;
                }
                
                this.bg.classList.remove(config.bgOn);
                this.bg.classList.add(config.bgOff);
                
                this.playSound('stop');
            }

            reset() {
                this.stop();
                this.elapsedTime = 0;
                this.laps = [];
                this.updateDisplay();
                this.renderLaps();
                
                const config = this.getThemeConfig();
                
                if (isLapMode) {
                    this.lapBtn.textContent = "LAP";
                    this.lapBtn.disabled = true;
                }
                
                this.startBtn.textContent = "START";
                this.updateStartButtonVisuals(config.btn, config.shadow, 'text-white');
            }

            lap() {
                if (this.isRunning) {
                    this.laps.unshift(this.elapsedTime);
                    this.renderLaps();
                    this.playSound('lap');
                } else {
                    this.reset();
                }
            }

            updateDisplay() {
                this.displayEl.innerHTML = this.formatTime(this.elapsedTime);
            }

            renderLaps() {
                const config = this.getThemeConfig();
                this.lapsContainer.innerHTML = '';
                
                if (this.laps.length === 0) {
                    this.emptyMsg.style.display = 'flex';
                } else {
                    this.emptyMsg.style.display = 'none';
                    this.laps.forEach((lapTime, index) => {
                        const lapNum = this.laps.length - index;
                        const row = document.createElement('tr');
                        row.className = `transition-colors border-b last:border-0 ${config.lapsRow}`;
                        
                        let splitTime = lapTime;
                        if (index < this.laps.length - 1) {
                            splitTime = lapTime - this.laps[index + 1];
                        }

                        row.innerHTML = `
                            <td class="pl-2 py-1">#${lapNum}</td>
                            <td class="text-right pr-2 py-1 font-bold ${index === 0 ? config.lapsTextHigh : ''}">
                                ${this.formatTimePlain(lapTime)}
                                <div class="text-[10px] opacity-50 font-normal">+${this.formatTimePlain(splitTime)}</div>
                            </td>
                        `;
                        this.lapsContainer.appendChild(row);
                    });
                }
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                this.muteIcon.className = this.isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            }

            playSound(type) {
                if (this.isMuted) return;
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                const now = ctx.currentTime;
                
                if (type === 'start') {
                    osc.frequency.setValueAtTime(800, now);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'stop') {
                    osc.frequency.setValueAtTime(400, now);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'lap') {
                    osc.frequency.setValueAtTime(1200, now);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                }
            }
        }

        // Initialize
        const sw1 = new Stopwatch(1);
        const sw2 = new Stopwatch(2);

        // Menu Toggle Logic
        function toggleMenu() {
            const bar = document.getElementById('control-bar');
            bar.classList.toggle('collapsed');
        }

        function resetAll() {
            sw1.reset();
            sw2.reset();
            const btn = document.querySelector('button[title="Reset All"] i');
            btn.classList.add('fa-spin');
            setTimeout(() => btn.classList.remove('fa-spin'), 500);
        }

        function cycleTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            const newTheme = themes[currentThemeIndex];
            sw1.applyTheme(newTheme);
            sw2.applyTheme(newTheme);
            
            const icon = document.querySelector('button[title="Change Theme"] i');
            icon.style.transform = "rotate(180deg)";
            setTimeout(() => icon.style.transform = "rotate(0deg)", 300);
        }

        function toggleLapMode() {
            isLapMode = !isLapMode;
            
            // Visual Toggle for button
            const btn = document.getElementById('btn-lap-toggle');
            if (isLapMode) {
                btn.classList.add('bg-white', 'text-black');
                btn.classList.remove('bg-black/50', 'text-white/70');
            } else {
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('bg-black/50', 'text-white/70');
            }

            // Update UI for both stopwatches
            [sw1, sw2].forEach(sw => {
                if (isLapMode) {
                    // Enable Lap Mode
                    sw.lapBtn.classList.remove('hidden');
                    sw.lapsWrapper.classList.remove('hidden');
                    sw.updateStartButtonVisuals(); // Will remove col-span-2
                    if (!sw.isRunning && sw.elapsedTime > 0) {
                        sw.lapBtn.textContent = 'RESET';
                        sw.lapBtn.disabled = false;
                    } else if (sw.isRunning) {
                         sw.lapBtn.textContent = 'LAP';
                         sw.lapBtn.disabled = false;
                    }
                } else {
                    // Disable Lap Mode
                    sw.lapBtn.classList.add('hidden');
                    sw.lapsWrapper.classList.add('hidden');
                    sw.updateStartButtonVisuals(); // Will add col-span-2
                }
            });
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e => console.log(e));
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const icon = document.querySelector('#btn-fullscreen i');
            icon.className = document.fullscreenElement ? 'fas fa-compress' : 'fas fa-expand';
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (sw1.isRunning || sw2.isRunning) {
                    if (sw1.isRunning) sw1.stop();
                    if (sw2.isRunning) sw2.stop();
                } else {
                    sw1.start();
                    sw2.start();
                }
            }
        });
    </script>
</body>
</html>
